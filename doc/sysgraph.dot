digraph {

    rankdir="LR";
    overlap=false;
    clusterrank="local";
    splines="line";
    color="gray";

    node [shape=rectangle, color="#aabb44", fontcolor="#444444"];

    subgraph cluster_routine {
        label="Routine";
        fontcolor="#aabb44";
        sms_model   [label="SMS model run"];
        sms_load    [label="SMS job"];

        // Version 2.26.3 of Graphviz sucks; same rank makes arrows point in wrong direction!
        //rank=same; sms_model sms_load;
    }

    subgraph cluster_ds {
        label="Data store";
        fontcolor="#aabb44";
        datastore   [label="Data store"];
    }

    subgraph cluster_dbserver {
        label="DB server";
        fontcolor="#aabb44";
        wdb         [label="WDB"];
        loader      [label="Loader"];
        rank = same; wdb; loader;
    }

    subgraph cluster_appserver {
        label="App server";
        fontcolor="#aabb44";
        weatherapi  [label="WeatherAPI"];
        wdb2ts      [label="WDB2TS"];
        syncer      [label="Syncer"];
        syncer2     [label="Syncer 2..N"];
        //rank = same; syncer; syncer2;
    }

    sms_model       -> sms_load;
    sms_load        -> datastore    [label="HTTP POST", fontcolor="#cc4444", fontsize="8"];
    datastore       -> syncer       [label="ZMQ PUB", fontcolor="#4444cc", fontsize="8"];
    syncer          -> datastore    [label="HTTP GET", fontcolor="#cc4444", fontsize="8"];
    syncer          -> loader       [label="ZMQ REQ", fontcolor="#4444cc", fontsize="8"];
    syncer          -> wdb2ts       [label="HTTP POST", fontcolor="#cc4444", fontsize="8"];
    syncer          -> wdb          [label="SQL WCI", fontcolor="#44cc44", fontsize="8"];
    loader          -> datastore    [label="HTTP GET", fontcolor="#cc4444", fontsize="8"];
    loader          -> wdb          [label="netcdfLoad", fontcolor="#44cc44", fontsize="8"];
    weatherapi      -> syncer       [label="ZMQ REQ", fontcolor="#4444cc", fontsize="8"];
    syncer          -> syncer2      [label="ZMQ PUB", fontcolor="#4444cc", fontsize="8"];
    syncer2         -> syncer       [label="ZMQ PUB", fontcolor="#4444cc", fontsize="8"];
}
